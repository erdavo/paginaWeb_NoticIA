<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil - NoticIA</title>

  <!-- Tailwind + fuentes -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <style>
    .material-symbols-outlined{ font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24; }
  </style>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#4cae4f",
            "background-light": "#f6f7f6",
            "background-dark": "#151d15",
            "surface-light": "#f1f3f1",
            "surface-dark": "#202a20",
            "text-light": "#131613",
            "text-dark": "#e1e3e1",
            "subtle-text-light": "#6c7f6d",
            "subtle-text-dark": "#9ca79c",
          },
          fontFamily: {"display": ["Inter", "sans-serif"]},
          borderRadius: {"xl":"1rem"},
        },
      },
    }
  </script>
</head>

<body class="font-display bg-background-light text-text-light min-h-screen flex flex-col">

  <!-- HEADER -->
  <header id="app-header" class="flex items-center justify-between px-8 py-4 border-b border-subtle-text-light/20 bg-white">
    <!-- Logo -->
<!-- Logo + nombre -->
    <div class="flex items-center gap-3">
    <a href="index.html" class="flex items-center justify-center w-10 h-10 rounded-full bg-primary/10 hover:bg-primary/20 transition shadow-sm hover:shadow-md active:scale-95">
        <img src="img/logo.png" alt="Logo NoticIA" class="h-6 w-6 object-contain" />
    </a>
    <a href="index.html" class="text-xl font-bold text-text-light dark:text-text-dark hover:text-primary transition">
        NoticIA
    </a>
    </div>


    <!-- Nav -->
    <nav class="flex gap-8 text-base font-medium">
      <a href="analizar.html" class="hover:text-primary transition">Analizar</a>
      <a href="foro.html" class="hover:text-primary transition">Foro</a>
      <a href="resumir.html" class="hover:text-primary transition">Resumir</a>
      <a href="ia.html" class="hover:text-primary transition">Hablar con la IA</a>
    </nav>

    <!-- Hook del men√∫ de perfil reutilizable -->
    <div id="profile-menu-root"></div>
  </header>

  <!-- CONTENIDO -->
  <main class="flex-1">
    <div class="mx-auto max-w-6xl px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

      <!-- Columna izquierda -->
      <aside class="lg:col-span-4 bg-white rounded-xl border border-gray-200 p-6 space-y-6">
        <!-- Cabecera de usuario -->
        <div class="flex items-center gap-4">
          <div class="flex items-center justify-center w-16 h-16 rounded-full ring-2 ring-gray-300">
            <span class="material-symbols-outlined text-5xl text-gray-700">account_circle</span>
          </div>
          <div class="min-w-0">
            <h2 id="pf-name" class="text-xl font-semibold truncate">Nombre</h2>
            <div id="pf-handle" class="text-sm text-gray-500 truncate">@nombre_12</div>
          </div>
        </div>

        <!-- Contribuciones / a√±o -->
        <div class="text-sm leading-6">
          <div id="pf-contrib" class="text-gray-700">Ha contribuido en 100 ocasiones</div>
          <div id="pf-joined" class="text-gray-700">Te uniste en 2025</div>
        </div>

        <!-- Seguidores / Seguidos -->
        <div class="grid grid-cols-2 gap-4 pt-2">
          <div class="text-center">
            <div class="text-sm font-medium underline underline-offset-2">Seguidores</div>
            <div id="pf-followers" class="text-2xl font-semibold font-mono">317</div>
          </div>
          <div class="text-center">
            <div class="text-sm font-medium underline underline-offset-2">Seguidos</div>
            <div id="pf-following" class="text-2xl font-semibold font-mono">389</div>
          </div>
        </div>

        <hr class="border-gray-200">

        <!-- Acciones -->
        <nav class="space-y-1">
          <a href="editar-perfil.html" class="flex items-center gap-3 px-2 py-2 rounded hover:bg-gray-50">
            <span class="material-symbols-outlined">edit</span><span>Editar perfil</span>
          </a>
          <a href="preferencias.html" class="flex items-center gap-3 px-2 py-2 rounded hover:bg-gray-50">
            <span class="material-symbols-outlined">tune</span><span>Preferencias</span>
          </a>

          <!-- ===== Selector de Idioma (desplegable) -->
          <div>
            <button id="pf-lang-toggle" aria-expanded="false"
              class="w-full text-left flex items-center gap-3 px-2 py-2 rounded hover:bg-gray-50">
              <span class="material-symbols-outlined">language</span>
              <span class="flex-1">Idioma</span>
              <span id="pf-lang-current" class="inline-flex items-center gap-2 text-sm">
                <span id="pf-flag" class="text-2xl leading-none">üá™üá∏</span>
                <span id="pf-lang-name">Espa√±ol</span>
              </span>
              <span id="pf-lang-arrow" class="material-symbols-outlined transition-transform duration-200">expand_more</span>
            </button>
            <div id="pf-lang-menu" class="hidden mt-2 border border-gray-200 rounded-md overflow-hidden">
              <!-- items se inyectan por JS -->
            </div>
          </div>

          <button id="btn-logout-side" class="w-full text-left flex items-center gap-3 px-2 py-2 rounded hover:bg-red-50 text-red-600">
            <span class="material-symbols-outlined">logout</span>
            <span class="flex-1">Cerrar sesi√≥n</span>
            <span class="material-symbols-outlined">arrow_forward</span>
          </button>
        </nav>
      </aside>

      <!-- Columna derecha (tabs + contenido) -->
      <section class="lg:col-span-8">
        <!-- Tabs -->
        <div class="bg-white rounded-t-xl border border-b-0 border-gray-200">
          <div class="flex gap-6 px-6 pt-4">
            <button
              data-tab="mine"
              class="tab-btn border-b-2 border-primary text-gray-900 font-semibold pb-2"
              onclick="goToTab('mis-publicaciones')">
              Mis publicaciones
            </button>

            <button
              data-tab="saved-posts"
              class="tab-btn text-gray-600 hover:text-gray-900 pb-2"
              onclick="goToTab('publicaciones-guardadas')">
              Publicaciones guardadas
            </button>

            <button
              data-tab="saved-summ"
              class="tab-btn text-gray-600 hover:text-gray-900 pb-2"
              onclick="goToTab('resumenes-guardados')">
              Res√∫menes guardados
            </button>
          </div>
        </div>

        <!-- Contenido -->
        <div class="bg-white rounded-b-xl border border-gray-200">
          <div id="feed" class="divide-y divide-gray-200"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="py-8"></footer>

  <!-- Men√∫ de perfil reutilizable -->
  <script src="js/profile-menu.js"></script>

  <!-- L√≥gica de la p√°gina de perfil -->
  <script>
    // ===== Utiles
    function getLS(key, def){ const v = localStorage.getItem(key); return (v===null||v===undefined)?def:v; }
    function numLS(key, def){ const n = parseInt(getLS(key, def), 10); return isNaN(n)?def:n; }
    function flagFromLang(code){
      const map = { es:"üá™üá∏", en:"üá¨üáß", fr:"üá´üá∑", de:"üá©üá™", it:"üáÆüáπ", pt:"üáµüáπ" };
      return map[(code||"es").toLowerCase()] || "üè≥Ô∏è";
    }
    function nameFromLang(code){
      const map = { es:"Espa√±ol", en:"English", fr:"Fran√ßais", de:"Deutsch", it:"Italiano", pt:"Portugu√™s" };
      return map[(code||"es").toLowerCase()] || (code||"").toUpperCase();
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // ===== Datos de usuario
    const username = getLS('noticia_username','Usuario');
    const handle   = getLS('noticia_handle','@nombre_12');
    const contrib  = numLS('noticia_contributions',100);
    const joined   = numLS('noticia_join_year',2025);
    const followers = numLS('noticia_followers',317);
    const following = numLS('noticia_following',389);
    const lang      = getLS('noticia_lang','es');

    // Pintar cabecera del panel izquierdo
    document.getElementById('pf-name').textContent = username;
    document.getElementById('pf-handle').textContent = handle;
    document.getElementById('pf-contrib').textContent = `Ha contribuido en ${contrib} ocasiones`;
    document.getElementById('pf-joined').textContent  = `Se uni√≥ en ${joined}`;
    document.getElementById('pf-followers').textContent = followers;
    document.getElementById('pf-following').textContent = following;
    document.getElementById('pf-flag').textContent = flagFromLang(lang);
    document.getElementById('pf-lang-name').textContent = nameFromLang(lang);

    // ===== Tabs (demo)
    const tabs = document.querySelectorAll('.tab-btn');
    const feed = document.getElementById('feed');

    const postsMine = [
      { id:'p1', author:'Yo', time:'13h', text:'¬°Shawelee!! Mirad esta noticia. ¬øEs falsa?', url:'https://noticiafalsa.com', comments:12, likes:106, saves:3, shares:1 },
      { id:'p2', author:'Yo', time:'1d',  text:'Otro ejemplo de publicaci√≥n con enlace y m√©tricas.', url:'https://ejemplo.com', comments:8, likes:54, saves:2, shares:0 }
    ];
    const savedPosts = [];
    const savedSummaries = [];

    function renderPosts(list){
      if(!list.length){ feed.innerHTML = '<div class="p-8 text-gray-500">No hay contenido por aqu√≠‚Ä¶</div>'; return; }
      feed.innerHTML = list.map(p => `
        <article class="p-6 space-y-3">
          <header class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-full ring-1 ring-gray-300">
              <span class="material-symbols-outlined">account_circle</span>
            </div>
            <div class="min-w-0">
              <div class="flex items-center gap-2 text-sm">
                <span class="font-semibold">${escapeHtml(p.author)}</span>
                <span class="text-gray-500">¬∑ ${escapeHtml(p.time)}</span>
              </div>
            </div>
          </header>
          <p class="text-[15px] leading-6">${escapeHtml(p.text)}</p>
          <a href="${p.url}" target="_blank" class="inline-flex items-center gap-2 text-primary hover:underline">
            <span class="truncate max-w-[60ch]">${escapeHtml(p.url)}</span>
            <span class="material-symbols-outlined text-base">open_in_new</span>
          </a>
          <div class="flex items-center gap-6 text-sm pt-1">
            <span class="inline-flex items-center gap-1 text-gray-600"><span class="material-symbols-outlined">chat_bubble</span>${p.comments}</span>
            <span class="inline-flex items-center gap-1 text-gray-600"><span class="material-symbols-outlined">favorite</span>${p.likes}</span>
            <span class="inline-flex items-center gap-1 text-gray-600"><span class="material-symbols-outlined">bookmark</span>${p.saves}</span>
            <span class="inline-flex items-center gap-1 text-gray-600"><span class="material-symbols-outlined">ios_share</span>${p.shares}</span>
          </div>
        </article>
      `).join('');
    }

    function setActive(tab){
      tabs.forEach(b=>{
        if(b.dataset.tab===tab){
          b.classList.add('border-b-2','border-primary','text-gray-900','font-semibold');
          b.classList.remove('text-gray-600');
        }else{
          b.classList.remove('border-b-2','border-primary','text-gray-900','font-semibold');
          b.classList.add('text-gray-600');
        }
      });
      if(tab==='mine') renderPosts(postsMine);
      if(tab==='saved-posts') renderPosts(savedPosts);
      if(tab==='saved-summ') renderPosts(savedSummaries);
    }

    // ===== Navegaci√≥n con hash
    const HASH_TO_TAB = {
      "mis-publicaciones": "mine",
      "publicaciones-guardadas": "saved-posts",
      "resumenes-guardados": "saved-summ",
    };
    const TAB_TO_HASH = {
      "mine": "mis-publicaciones",
      "saved-posts": "publicaciones-guardadas",
      "saved-summ": "resumenes-guardados",
    };

    function goToTab(hashKey) {
      const tabKey = HASH_TO_TAB[hashKey] || "mine";
      setActive(tabKey);
      history.replaceState(null, "", "#" + hashKey);
    }

    function syncFromHash() {
      const h = (location.hash || "").replace("#", "");
      const tabKey = HASH_TO_TAB[h] || "mine";
      setActive(tabKey);
    }

    // Eventos de tabs + hash
    tabs.forEach(b => b.addEventListener('click', ()=> setActive(b.dataset.tab)));
    window.addEventListener("DOMContentLoaded", syncFromHash);
    window.addEventListener("hashchange", syncFromHash);

    // ===== Idioma (panel izquierdo): desplegable
    const pfLangToggle = document.getElementById('pf-lang-toggle');
    const pfLangMenu   = document.getElementById('pf-lang-menu');
    const pfLangArrow  = document.getElementById('pf-lang-arrow');
    const pfFlagEl     = document.getElementById('pf-flag');
    const pfLangNameEl = document.getElementById('pf-lang-name');

    // Pinta items del men√∫ de idioma
    const langs = ["es","en","fr","de","it","pt"];
    pfLangMenu.innerHTML = langs.map(code => (
      `<button type="button" class="w-full text-left px-4 py-2 flex items-center gap-3 hover:bg-gray-50" data-lang="${code}">
         <span class="text-xl">${flagFromLang(code)}</span>
         <span class="flex-1">${nameFromLang(code)}</span>
         ${code===lang?'<span class="material-symbols-outlined text-primary">check</span>':''}
       </button>`
    )).join('');

    pfLangToggle.addEventListener('click', ()=>{
      const open = !pfLangMenu.classList.contains('hidden');
      if (open) {
        pfLangMenu.classList.add('hidden');
        pfLangToggle.setAttribute('aria-expanded','false');
        pfLangArrow.classList.remove('rotate-180');
      } else {
        pfLangMenu.classList.remove('hidden');
        pfLangToggle.setAttribute('aria-expanded','true');
        pfLangArrow.classList.add('rotate-180');
      }
    });

    pfLangMenu.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-lang]');
      if (!btn) return;
      const newLang = btn.getAttribute('data-lang');
      localStorage.setItem('noticia_lang', newLang);
      // Actualiza UI inmediata
      pfFlagEl.textContent = flagFromLang(newLang);
      pfLangNameEl.textContent = nameFromLang(newLang);
      // Recarga para que todo el sitio herede el idioma
      location.reload();
    });

    // Logout lateral
    document.getElementById('btn-logout-side').addEventListener('click', ()=>{
      localStorage.removeItem('auth_token');
      location.href = 'login.html';
    });
  </script>
</body>
</html>
